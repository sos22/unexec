all:: tests/smoke tests/iterate tests/signals

tests/%: tests/%.o libunexec.so
	gcc -Wl,-rpath -Wl,`pwd` -g $^ -o $@

tests/%.o: tests/%.c unexec.h
	gcc -g -I. -Wall -Wextra -c $< -o $@

tests/smoke.res: tests/smoke
	./$< ./tests/new_smoke
	./tests/new_smoke
	rm -f ./tests/new_smoke
	touch $@

test:: tests/smoke.res

clean::
	rm -f tests/*~ tests/*.o tests/smoke tests/*.res tests/iterate tests/signals
